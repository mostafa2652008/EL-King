<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      height: 100vh;
      background: linear-gradient(180deg, #D32F2F 0%, #b71c1c 100%);
      position: fixed;
      top: 0;
      right: 0;
      box-shadow: -8px 0 30px rgba(211,47,47,0.3);
      z-index: 1000;
      overflow-y: auto;
    }
    .sidebar-header {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      color: white;
      padding: 25px 20px;
      text-align: center;
      font-size: 20px;
      font-weight: 700;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    .sidebar-menu {
      padding: 10px 0;
    }
    .menu-item {
      display: flex;
      align-items: center;
      padding: 16px 25px;
      color: rgba(255,255,255,0.9);
      text-decoration: none;
      font-size: 16px;
      font-weight: 500;
      transition: all 0.3s ease;
      border-right: 4px solid transparent;
      margin: 2px 10px;
      border-radius: 15px 0 0 15px;
    }
    .menu-item:hover {
      background: rgba(255,255,255,0.2);
      color: white;
      border-right-color: #fff;
      transform: translateX(-5px);
    }
    .menu-item.active {
      background: rgba(255,255,255,0.25);
      color: white;
      border-right-color: #FFEBEE;
      font-weight: 700;
    }
    .menu-icon {
      font-size: 22px;
      margin-left: 15px;
      width: 25px;
    }

    /* Main Content */
    .main-content {
      margin-right: 280px;
      padding: 40px 30px;
      min-height: 100vh;
    }

    .page-title {
      font-size: 32px;
      font-weight: 700;
      color: #D32F2F;
      text-align: center;
      margin-bottom: 15px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    .welcome {
      text-align: center;
      font-size: 20px;
      color: #444;
      margin-bottom: 45px;
      font-weight: 500;
    }

    .units-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 25px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .unit-card {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(12px);
      border-radius: 24px;
      box-shadow: 0 12px 35px rgba(0,0,0,0.12);
      overflow: hidden;
      transition: all 0.4s ease;
      border: 1px solid rgba(255,255,255,0.4);
      cursor: pointer;
    }

    .unit-card:hover {
      transform: translateY(-12px);
      box-shadow: 0 25px 60px rgba(211,47,47,0.22);
    }

    .unit-content {
      padding: 30px;
      text-align: center;
    }

    .unit-icon {
      font-size: 64px;
      margin-bottom: 20px;
      line-height: 1;
    }

    .unit-name {
      font-size: 24px;
      font-weight: 700;
      color: #222;
      margin-bottom: 12px;
    }

    .unit-stats {
      font-size: 16px;
      color: #555;
      margin-bottom: 20px;
    }

    .progress-container {
      height: 12px;
      background: #f0f0f0;
      border-radius: 6px;
      overflow: hidden;
      margin: 18px 0;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #27ae60, #2ecc71);
      transition: width 0.8s ease;
    }

    .progress-text {
      font-size: 18px;
      font-weight: 700;
      color: #27ae60;
      margin-bottom: 12px;
    }

    .accuracy-text {
      font-size: 14px;
      color: #666;
    }

    .start-btn {
      width: 100%;
      padding: 16px;
      margin-top: 20px;
      background: linear-gradient(135deg, #D32F2F, #b71c1c);
      color: white;
      border: none;
      border-radius: 14px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
    }

    .start-btn:hover {
      background: linear-gradient(135deg, #b71c1c, #9c1a1a);
      transform: translateY(-2px);
    }

    .no-units {
      text-align: center;
      font-size: 22px;
      color: #777;
      margin-top: 100px;
      line-height: 1.6;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }
      .main-content {
        margin-right: 0;
        padding: 30px 20px;
        padding-bottom: 90px;
      }
      .units-grid {
        grid-template-columns: 1fr;
      }
      .bottom-nav {
        display: flex;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
        padding: 12px 0;
        z-index: 999;
      }
      .bottom-nav a {
        flex: 1;
        text-align: center;
        padding: 8px;
        color: #666;
        text-decoration: none;
        font-size: 13px;
      }
      .bottom-nav a.active {
        color: #D32F2F;
        font-weight: 700;
      }
      .nav-icon {
        font-size: 24px;
        display: block;
        margin-bottom: 4px;
      }
    }
  </style>
</head>
<body>

<div class="sidebar">
  <div class="sidebar-header">
    <i class="fas fa-graduation-cap"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
  </div>
  <div class="sidebar-menu">
    <a href="index.html" class="menu-item">
      <i class="fas fa-chalkboard-teacher menu-icon"></i>
      Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³
    </a>
    <a href="student.html" class="menu-item active">
      <i class="fas fa-user-graduate menu-icon"></i>
      ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
    </a>
    <a href="cards.html" class="menu-item">
      <i class="fas fa-cards menu-icon"></i>
      Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
    </a>
    <a href="#" onclick="signOutUser(); return false;" class="menu-item">
      <i class="fas fa-sign-out-alt menu-icon"></i>
      Ø®Ø±ÙˆØ¬
    </a>
  </div>
</div>

<div class="bottom-nav">
  <a href="index.html">
    <span class="nav-icon">ğŸ‘¨â€ğŸ«</span> Ø§Ù„Ù…Ø¯Ø±Ø³
  </a>
  <a href="student.html" class="active">
    <span class="nav-icon">ğŸ‘¨â€ğŸ“</span> Ø§Ù„Ø·Ø§Ù„Ø¨
  </a>
  <a href="cards.html">
    <span class="nav-icon">ğŸƒ</span> Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
  </a>
</div>

<div class="main-content">
  <h1 class="page-title">ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ <i class="fas fa-user-graduate"></i></h1>
  <div class="welcome" id="userName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

  <div class="units-grid" id="units"></div>

  <div class="no-units" id="noUnitsMsg" style="display:none;">
    Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ ğŸ˜”<br>
    Ø§Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…Ø¯Ø±Ø³ Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
  import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "MY_API",
    authDomain: "educate-a2aad.firebaseapp.com",
    projectId: "educate-a2aad",
    storageBucket: "educate-a2aad.firebasestorage.app",
    messagingSenderId: "237633521728",
    appId: "1:237633521728:web:1ec7e6aae3ae0711ef37a5"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let userDisplayName = "Ø·Ø§Ù„Ø¨";

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "login.html";
      return;
    }

    localStorage.setItem("userId", user.uid);

    // Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨
    try {
      const userDoc = await getDoc(doc(db, "users", user.uid));
      if (userDoc.exists()) {
        userDisplayName = userDoc.data().displayName || "Ø·Ø§Ù„Ø¨";
      }
    } catch (e) {
      console.error("Error getting user name:", e);
    }

    document.getElementById("userName").textContent = 
      userDisplayName === "Ø·Ø§Ù„Ø¨" ? "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹" : `Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙŠØ§ ${userDisplayName} ğŸ‘‹`;

    loadUnits();
  });

  async function loadUnits() {
    const container = document.getElementById("units");
    const noUnitsMsg = document.getElementById("noUnitsMsg");
    
    try {
      const querySnapshot = await getDocs(collection(db, "units"));
      if (querySnapshot.empty) {
        noUnitsMsg.style.display = "block";
        return;
      }

      container.innerHTML = "";
      const userId = localStorage.getItem("userId");

      querySnapshot.forEach((docSnap) => {
        const unit = docSnap.data();
        const unitId = docSnap.id;

        const totalCards = unit.cards?.length || 0;
        let completed = 0;
        let totalAccuracy = 0;

        unit.cards?.forEach(card => {
          if (card.results?.[userId]) {
            completed++;
            totalAccuracy += card.results[userId].accuracy || 0;
          }
        });

        const progress = totalCards > 0 ? Math.round((completed / totalCards) * 100) : 0;
        const avgAccuracy = completed > 0 ? Math.round(totalAccuracy / completed) : 0;

        // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø°ÙƒÙŠØ© Ø­Ø³Ø¨ Ø§Ø³Ù… Ø§Ù„ÙˆØ­Ø¯Ø©
        let icon = "ğŸ“–";
        const name = (unit.unitName || "").toLowerCase();
        if (name.includes("greeting") || name.includes("ØªØ­ÙŠØ©")) icon = "ğŸ‘‹";
        else if (name.includes("food") || name.includes("Ø·Ø¹Ø§Ù…")) icon = "ğŸ”";
        else if (name.includes("family") || name.includes("Ø¹Ø§Ø¦Ù„Ø©")) icon = "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§";
        else if (name.includes("travel") || name.includes("Ø³ÙØ±")) icon = "âœˆï¸";
        else if (name.includes("school") || name.includes("Ù…Ø¯Ø±Ø³Ø©")) icon = "ğŸ“š";
        else if (name.includes("color") || name.includes("Ø£Ù„ÙˆØ§Ù†")) icon = "ğŸ¨";
        else if (name.includes("number") || name.includes("Ø£Ø±Ù‚Ø§Ù…")) icon = "ğŸ”¢";

        const card = document.createElement("div");
        card.className = "unit-card";
        card.innerHTML = `
          <div class="unit-content">
            <div class="unit-icon">${icon}</div>
            <div class="unit-name">${unit.unitName || "ÙˆØ­Ø¯Ø© ØºÙŠØ± Ù…Ø³Ù…Ø§Ø©"}</div>
            <div class="unit-stats">${totalCards} ÙƒÙ„Ù…Ø©</div>
            
            <div class="progress-container">
              <div class="progress-bar" style="width: ${progress}%"></div>
            </div>
            
            <div class="progress-text">Ø£Ù†Ø¬Ø²Øª ${progress}%</div>
            ${avgAccuracy > 0 ? `
              <div class="accuracy-text">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯Ù‚Ø©: ${avgAccuracy}%</div>
            ` : ''}
            
            <button class="start-btn">
              ${progress === 100 ? 'Ø±Ø§Ø¬Ø¹ Ø§Ù„ÙˆØ­Ø¯Ø©' : 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†'}
            </button>
          </div>
        `;

        card.onclick = () => {
          localStorage.setItem("currentUnitId", unitId);
          window.location.href = "cards.html";
        };

        container.appendChild(card);
      });
    } catch (error) {
      console.error("Error loading units:", error);
      noUnitsMsg.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª ğŸ˜•";
      noUnitsMsg.style.display = "block";
    }
  }

  window.signOutUser = async () => {
    await signOut(auth);
    localStorage.removeItem("userId");
    window.location.href = "login.html";
  };
const userDoc = await getDoc(doc(db, "users", user.uid));
const displayName = userDoc.exists() ? userDoc.data().displayName || "Ø·Ø§Ù„Ø¨" : "Ø·Ø§Ù„Ø¨";
document.getElementById("userName").textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙŠØ§ ${displayName} ğŸ‘‹`;
localStorage.setItem("displayName", displayName);
</script>
</body>
</html>

